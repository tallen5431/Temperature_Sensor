[
  {
    "timestamp": "2025-10-19T18:37:17.827401",
    "patch_name": "Patch 2025-10-19 18:37",
    "description": "Enhance Dash temperature dashboard with dark theme, status indicator, download button, adjustable refresh rate, and rolling graph.",
    "files_modified": [
      "app.py",
      "requirements.txt"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T18:42:11.189647",
    "patch_name": "Patch 2025-10-19 18:42",
    "description": "Fix CSV not writing reliably, remove fragile callback_map edit, and add manual Save button.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T18:48:19.243688",
    "patch_name": "Patch 2025-10-19 18:48",
    "description": "Upgrade chart visuals: smooth curves, gradient fills, color scheme, live gauge card, and improved layout.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T18:49:33.188825",
    "patch_name": "Patch 2025-10-19 18:49",
    "description": "Upgrade chart visuals: smooth curves, gradient fills, color scheme, live gauge card, and improved layout.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T19:21:20.989900",
    "patch_name": "Patch 2025-10-19 19:21",
    "description": "Align both y-axes (°C and °F) to start at zero and enhance chart readability.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T19:21:40.494639",
    "patch_name": "Patch 2025-10-19 19:21",
    "description": "Align both y-axes (°C and °F) to start at zero and enhance chart readability.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T19:26:02.556932",
    "patch_name": "Patch 2025-10-19 19:26",
    "description": "Align both y-axes (°C and °F) to start at zero and enhance chart readability.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-19T19:45:04.172291",
    "patch_name": "Patch 2025-10-19 19:45",
    "description": "Upgrade temperature dashboard with zero-aligned axes, trend indicator, rolling average smoothing, and selectable time window.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-20T19:00:57.309055",
    "patch_name": "Patch 2025-10-20 19:00",
    "description": "",
    "files_modified": [
      "app.py",
      "thermo_logger.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-20T19:15:46.913518",
    "patch_name": "Patch 2025-10-20 19:15",
    "description": "Add modular Plotly graph + keep settings editable on the page",
    "files_modified": [
      "components/temp_graph.py"
    ],
    "summary": {
      "total": 2,
      "ok": 1,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-20T19:16:29.223449",
    "patch_name": "Patch 2025-10-20 19:16",
    "description": "Add modular Plotly graph + keep settings editable on the page",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-20T19:24:49.314968",
    "patch_name": "Patch 2025-10-20 19:24",
    "description": "Update modular graph to single-series view with y-axis starting at 0 and unit selector.",
    "files_modified": [
      "components/temp_graph.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:00:44.461115",
    "patch_name": "Patch 2025-10-21 18:00",
    "description": "[0] Unify refresh with interval; [1] show probe IDs in list",
    "files_modified": [
      "app.py",
      "components/probe_panel.py"
    ],
    "summary": {
      "total": 3,
      "ok": 2,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:01:00.462058",
    "patch_name": "Patch 2025-10-21 18:01",
    "description": "Unify graph refresh with main Interval control and surface better visuals/markers; this edit touches ONLY components/temp_graph.py",
    "files_modified": [
      "components/temp_graph.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:37:30.115998",
    "patch_name": "Patch 2025-10-21 18:37",
    "description": "Add probe_id support across ingest & storage; show IDs in probe panel; color graph by probe when available; auto-provision probes when interval changes.",
    "files_modified": [
      "core/storage.py",
      "api/routes.py"
    ],
    "summary": {
      "total": 5,
      "ok": 2,
      "skipped": 3,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:42:58.809569",
    "patch_name": "Patch 2025-10-21 18:42",
    "description": "Replace temp graph to show probe badges and clearer visuals; refresh on ui-refresh.",
    "files_modified": [
      "components/temp_graph.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:43:14.690619",
    "patch_name": "Patch 2025-10-21 18:43",
    "description": "Add a probe panel that lists discovered probes and exposes rescan + autoprov controls.",
    "files_modified": [
      "components/probe_panel.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T18:43:31.051780",
    "patch_name": "Patch 2025-10-21 18:43",
    "description": "Wire ProbePanel in layout and register callbacks for graph + probes.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T19:13:12.713265",
    "patch_name": "Patch 2025-10-21 19:13",
    "description": "Replace app.py and components/probe_panel.py with modular versions that wire callbacks and show probe badges. Saving Logging Controls also pushes the new interval to discovered probes.",
    "files_modified": [
      "components/probe_panel.py",
      "app.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T20:08:18.858375",
    "patch_name": "Patch 2025-10-21 20:08",
    "description": "Wire up Setup Helper, make ProbePanel show real probe IDs, add discovery.scan(), and sync UI refresh to logging interval.",
    "files_modified": [
      "probe_discovery.py"
    ],
    "summary": {
      "total": 3,
      "ok": 1,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-21T20:25:41.494972",
    "patch_name": "Patch 2025-10-21 20:25",
    "description": "Update app.py only: wire SetupHelper, add its row, sync UI refresh interval, prefer cfg provision_token.",
    "files_modified": [
      "app.py",
      "app.py",
      "app.py",
      "app.py",
      "app.py",
      "app.py"
    ],
    "summary": {
      "total": 6,
      "ok": 6,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T01:17:26.535896",
    "patch_name": "Patch 2025-10-22 01:17",
    "description": "Auto-start probe discovery; prefer IP for provisioning; derive PUBLIC_BASE from LAN IP; make whoami prefer IP. Hash guards added for CRLF/LF.",
    "files_modified": [
      "app.py",
      "components/probe_panel.py",
      "components/probe_panel.py"
    ],
    "summary": {
      "total": 5,
      "ok": 3,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T01:20:12.571902",
    "patch_name": "Patch 2025-10-22 01:20",
    "description": "Replace api/routes.py to fix indentation error and prefer IP for provisioning.",
    "files_modified": [
      "api/routes.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T01:29:23.426628",
    "patch_name": "Patch 2025-10-22 01:29",
    "description": "Replace the per-probe provision call with an IP-first one-liner to avoid indentation issues.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T01:31:39.769689",
    "patch_name": "Patch 2025-10-22 01:31",
    "description": "Prefer IP everywhere: discovery, UI list, and Save->Auto-provision. Also use _public_base() for Save path.",
    "files_modified": [
      "components/probe_panel.py"
    ],
    "summary": {
      "total": 3,
      "ok": 1,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T12:57:03.827292",
    "patch_name": "Patch 2025-10-22 12:57",
    "description": "Add a compat wrapper that accepts zeroconf's keyword-callback style and forward to the original _handle; update ServiceBrowser to use it.",
    "files_modified": [
      "probe_discovery.py",
      "probe_discovery.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T13:17:28.801276",
    "patch_name": "Patch 2025-10-22 13:17",
    "description": "Pin zeroconf to a safe range; no changes to mdns_advert since it does not use ServiceBrowser.",
    "files_modified": [
      "requirements.txt"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T13:25:21.586906",
    "patch_name": "Patch 2025-10-22 13:25",
    "description": "Use _public_base() when pushing provision from Logging Controls.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T13:35:53.935191",
    "patch_name": "Patch 2025-10-22 13:35",
    "description": "Add background auto-provisioner that provisions discovered probes by IP to the hub's /api/ingest; start it from app.py.",
    "files_modified": [
      "auto_provisioner.py",
      "app.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:24:23.748170",
    "patch_name": "Patch 2025-10-22 15:24",
    "description": "Add a single, product-ready README.md to the project root.",
    "files_modified": [
      "README.md"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:41:15.460628",
    "patch_name": "Patch 2025-10-22 15:41",
    "description": "Fix config API, strengthen ingest/provision endpoints, and wire app.py to core MdnsAdvert without adding/removing top-level files. Keep api/ and components/ layout intact.",
    "files_modified": [
      "core/config.py",
      "api/routes.py",
      "app.py",
      "README.md"
    ],
    "summary": {
      "total": 4,
      "ok": 4,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:46:02.121555",
    "patch_name": "Patch 2025-10-22 15:46",
    "description": "Fix discovery props key, make ingest accept flexible keys and use core/storage helpers, and stop discovery on shutdown.",
    "files_modified": [],
    "summary": {
      "total": 2,
      "ok": 0,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:49:49.786084",
    "patch_name": "Patch 2025-10-22 15:49",
    "description": "Fix discovery props key, make ingest accept flexible keys and use core/storage helpers, and stop discovery on shutdown.",
    "files_modified": [
      "api/routes.py",
      "app.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:53:08.973850",
    "patch_name": "Patch 2025-10-22 15:53",
    "description": "Restore full app.py and append finder.stop() call in the shutdown section without removing any code.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T15:55:50.500826",
    "patch_name": "Patch 2025-10-22 15:55",
    "description": "Refine routes.py: simplified auth, sorted probe list, UTF-8 CSV writes, richer /health output, and added counts in provisioning response.",
    "files_modified": [
      "api/routes.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:01:30.068800",
    "patch_name": "Patch 2025-10-22 16:01",
    "description": "Phase 1: add professional tabbed layout, navbar, and theme for end users.",
    "files_modified": [
      "components/layout_main.py",
      "assets/theme.css",
      "app.py"
    ],
    "summary": {
      "total": 3,
      "ok": 3,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:05:56.148024",
    "patch_name": "Patch 2025-10-22 16:05",
    "description": "Phase 2: add polished dashboard with metric cards, live temperature gauge, and status indicators.",
    "files_modified": [
      "components/dashboard_view.py",
      "components/layout_main.py",
      "app.py"
    ],
    "summary": {
      "total": 3,
      "ok": 3,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:11:30.066280",
    "patch_name": "Patch 2025-10-22 16:11",
    "description": "Phase 3: Add branding, help modal overlay, footer, and visual polish.",
    "files_modified": [
      "components/help_modal.py",
      "components/layout_main.py",
      "assets/theme.css",
      "app.py"
    ],
    "summary": {
      "total": 4,
      "ok": 4,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:22:51.152195",
    "patch_name": "Patch 2025-10-22 16:22",
    "description": "Phase 4: unify dashboard heights, add live heartbeat indicator, rebuild devices tab with responsive probe cards, polish CSS.",
    "files_modified": [
      "components/devices_panel.py",
      "components/dashboard_view.py",
      "components/layout_main.py",
      "assets/theme.css",
      "app.py"
    ],
    "summary": {
      "total": 5,
      "ok": 5,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:26:47.643904",
    "patch_name": "Patch 2025-10-22 16:26",
    "description": "Fix device panel Unknown probe names by extracting name/id from probe properties; ensure last_seen is parsed properly.",
    "files_modified": [
      "components/devices_panel.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:28:37.618822",
    "patch_name": "Patch 2025-10-22 16:28",
    "description": "Pass cfg correctly to dashboard callbacks to restore live data updates.",
    "files_modified": [
      "components/layout_main.py",
      "components/layout_main.py",
      "app.py"
    ],
    "summary": {
      "total": 3,
      "ok": 3,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:35:32.329161",
    "patch_name": "Patch 2025-10-22 16:35",
    "description": "Mark probe as active in discovery when it sends ingest data, ensuring Devices tab shows correct last_seen and online status.",
    "files_modified": [
      "api/routes.py",
      "api/routes.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:49:36.221435",
    "patch_name": "Patch 2025-10-22 16:49",
    "description": "Add margin and height adjustments to fix gauge text cutoff, and improve probe online tracking by matching probe_id, name, or host fields.",
    "files_modified": [
      "components/dashboard_view.py",
      "assets/theme.css",
      "api/routes.py"
    ],
    "summary": {
      "total": 3,
      "ok": 3,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T16:56:19.208410",
    "patch_name": "Patch 2025-10-22 16:56",
    "description": "Enhance /api/ingest to update probe last_seen reliably by matching key, id, name, host, or properties.id fields.",
    "files_modified": [],
    "summary": {
      "total": 1,
      "ok": 0,
      "skipped": 1,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T17:01:14.271863",
    "patch_name": "Patch 2025-10-22 17:01",
    "description": "Improve /api/ingest online probe tracking by matching key, id, name, host, and properties.id, and adding fallback creation when not found.",
    "files_modified": [
      "api/routes.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T17:17:39.430744",
    "patch_name": "Patch 2025-10-22 17:17",
    "description": "Fix probe last_seen updates for ProbeInfo objects and add Phase 7 UI enhancements: LIVE badge beside gauge title and CSV download button under graph.",
    "files_modified": [
      "api/routes.py",
      "components/dashboard_view.py"
    ],
    "summary": {
      "total": 4,
      "ok": 2,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T17:18:46.002003",
    "patch_name": "Patch 2025-10-22 17:18",
    "description": "Add a CSV download button and callback to dashboard_view.py under the temperature history graph.",
    "files_modified": [],
    "summary": {
      "total": 2,
      "ok": 0,
      "skipped": 2,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-10-22T19:55:50.222817",
    "patch_name": "Patch 2025-10-22 19:55",
    "description": "Add a /download/<filename> endpoint in app.py to serve CSV logs for the Download CSV button.",
    "files_modified": [
      "app.py"
    ],
    "summary": {
      "total": 1,
      "ok": 1,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null
  },
  {
    "timestamp": "2025-12-15T13:48:05.492649",
    "patch_name": "Patch 2025-12-15 13:48",
    "description": "Fix /api/config GET/POST so it reliably reads/writes cfg.data for Config class (with cfg.lock + cfg.save), while still supporting dict configs.",
    "files_modified": [
      "api/routes.py",
      "api/routes.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null,
    "diff_results": [
      {
        "path": "api/routes.py",
        "diff": "--- a/api/routes.py+++ b/api/routes.py@@ -67,13 +67,37 @@ \n     @bp.get(\"/config\")\n     def get_config():\n-        try:\n-            return jsonify(cfg.to_dict())\n-        except Exception:\n-            try:\n-                return jsonify(cfg.data)\n-            except Exception:\n-                return jsonify({})\n+        \"\"\"Return config as JSON.\n+\n+        Supports:\n+          - dict config\n+          - Config-like object with .data (and optional .lock)\n+          - objects implementing .to_dict()\n+        \"\"\"\n+        # Plain dict\n+        if isinstance(cfg, dict):\n+            return jsonify(cfg)\n+\n+        # Prefer to_dict() if present\n+        if hasattr(cfg, \"to_dict\"):\n+            try:\n+                return jsonify(cfg.to_dict())\n+            except Exception:\n+                pass\n+\n+        # Prefer cfg.data if present (your Config class)\n+        if hasattr(cfg, \"data\"):\n+            try:\n+                lock = getattr(cfg, \"lock\", None)\n+                data_obj = getattr(cfg, \"data\") or {}\n+                if lock:\n+                    with lock:\n+                        return jsonify(dict(data_obj))\n+                return jsonify(dict(data_obj))\n+            except Exception:\n+                pass\n+\n+        return jsonify({})\n \n     @bp.post(\"/config\")\n     def set_config():\n",
        "status": "ok",
        "message": "modified"
      },
      {
        "path": "api/routes.py",
        "diff": "--- a/api/routes.py+++ b/api/routes.py@@ -101,13 +101,54 @@ \n     @bp.post(\"/config\")\n     def set_config():\n-        if not _check_auth():\n-            return jsonify(ok=False, error=\"unauthorized\"), 401\n+        \"\"\"Update config values and persist when possible.\"\"\"\n+        if not _check_auth():\n+            return jsonify(ok=False, error=\"unauthorized\"), 401\n+\n         data = request.get_json(silent=True) or {}\n-        try:\n+        if not isinstance(data, dict):\n+            return jsonify(ok=False, error=\"invalid_json\"), 400\n+\n+        # Dict config: update in place\n+        if isinstance(cfg, dict):\n             cfg.update(data)\n-        except Exception:\n-            pass\n+            return jsonify(ok=True, config=cfg)\n+\n+        # Config class: update cfg.data under lock, then save()\n+        if hasattr(cfg, \"data\"):\n+            try:\n+                lock = getattr(cfg, \"lock\", None)\n+                if lock:\n+                    with lock:\n+                        cfg.data.update(data)  # type: ignore[attr-defined]\n+                else:\n+                    cfg.data.update(data)  # type: ignore[attr-defined]\n+\n+                if hasattr(cfg, \"save\"):\n+                    try:\n+                        cfg.save()  # type: ignore[attr-defined]\n+                    except Exception:\n+                        # Don't fail request if persistence fails\n+                        pass\n+\n+                return jsonify(ok=True, config=dict(getattr(cfg, \"data\") or {}))\n+            except Exception as e:\n+                return jsonify(ok=False, error=str(e)), 400\n+\n+        # Last resort: try update(), then setattr\n+        if hasattr(cfg, \"update\"):\n+            try:\n+                cfg.update(data)\n+                return jsonify(ok=True)\n+            except Exception:\n+                pass\n+\n+        for k, v in data.items():\n+            try:\n+                setattr(cfg, k, v)\n+            except Exception:\n+                pass\n+\n         return jsonify(ok=True)\n \n     @bp.get(\"/probes\")\n",
        "status": "ok",
        "message": "modified"
      }
    ]
  },
  {
    "timestamp": "2025-12-15T13:54:12.288794",
    "patch_name": "Patch 2025-12-15 13:54",
    "description": "Fix provisioning base URL: replace hardcoded 127.0.0.1 with PUBLIC_BASE override or auto-detected LAN IP + PORT. (Single area change in app.py).",
    "files_modified": [
      "app.py",
      "app.py"
    ],
    "summary": {
      "total": 2,
      "ok": 2,
      "skipped": 0,
      "failed": 0
    },
    "success": true,
    "patch_data": null,
    "error_message": null,
    "diff_results": [
      {
        "path": "app.py",
        "diff": "--- a/app.py+++ b/app.py@@ -1,4 +1,5 @@ import os\n+import socket\n from pathlib import Path\n import dash\n from dash import Dash, html, Input, Output\n",
        "status": "ok",
        "message": "modified"
      },
      {
        "path": "app.py",
        "diff": "--- a/app.py+++ b/app.py@@ -25,7 +25,28 @@ except Exception: pass\n \n server = Flask(__name__)\n-api_bp = create_api(cfg, str(CSV_FILE), finder, lambda: 'http://127.0.0.1:8080', os.getenv('SERVER_TOKEN', ''))\n+def _detect_lan_ip() -> str:\n+    \"\"\"Best-effort LAN IP detection (no extra deps).\"\"\"\n+    try:\n+        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n+        try:\n+            # No packets actually sent; picks outbound interface.\n+            s.connect((\"8.8.8.8\", 80))\n+            return s.getsockname()[0]\n+        finally:\n+            s.close()\n+    except Exception:\n+        return \"127.0.0.1\"\n+\n+\n+def _public_base() -> str:\n+    base = (os.getenv(\"PUBLIC_BASE\", \"\") or \"\").strip()\n+    if base:\n+        return base.rstrip(\"/\")\n+    port = int(os.getenv(\"PORT\", \"8080\"))\n+    return f\"http://{_detect_lan_ip()}:{port}\"\n+\n+api_bp = create_api(cfg, str(CSV_FILE), finder, _public_base, os.getenv('SERVER_TOKEN', ''))\n server.register_blueprint(api_bp)\n \n app = Dash(__name__, external_stylesheets=[dbc.themes.CYBORG], server=server, suppress_callback_exceptions=True)\n",
        "status": "ok",
        "message": "modified"
      }
    ]
  }
]